<!--
Filename: FLoorsetEditor.razor
File Purpose: Floorset Editor

Program Purpose:
The purpose of PLOT is to allow users to easily create, manage, 
and allocate floorsets for Platos Closet. 

Note: This is a piece of what will be made into the floorset
editor file. This handles the importation of an excel file

Author (of import excel file code): Andrew Miller (3/16/2025)
-->

@page "/floorset-editor"
@rendermode InteractiveServer
@inject IJSRuntime JS
@using Plot.Components.PartialComponents.SlideOut
@using Plot.Components.PartialComponents.Button
@using Plot.Components.PartialComponents.FileInput
@using Plot.Components.PartialComponents.Modal

<!-- Grid Area -->
<div class="wrapper" width="500px" height="500px">
    <div class="main-content">
        <div class="grid">
            @for (int i = 0; i < 50; i++)
            {
                @for (int j = 0; j < 50; j++)
                {
                    <div class="grid-cell" id="cell-@i-@j"></div>
                }
            }
        </div>
    </div>

</div>

<SlideOut Id="FloorsetSlideOut">
    <Button Class="Button" Id="buttonImportFile" Variant="primary" OnClickFunction="OpenImportModal"
        Icon="fa-solid fa-file-import" IsDisabled=false TextAlignment="center">
        Import Excel File
    </Button>
</SlideOut>

<!-- Everything below should be kept when creating the final FloorsetEditor file
     id of importExcelModal must be harmonized with the id used for data-bs-target in the Button component for importing a file
-->

<!-- Import Excel File Modal -->
<Modal Title="Import Excel File" Id="importExcelModal" Class="modal-dialog">

    <!--Body content includes file to upload-->
    <BodyContent>
        <p>Import an Excel File</p>
        <FileInput Id="ImportFile" OnFileSelected="HandleFileSelected"></FileInput>
    </BodyContent>

    <FooterContent>
        <!-- To fix: Cancel button is included in PartialComponents/Modal/Modal.razor
         but appropriate alignment still needs to be handled 
         -->

        <!--Import button
        Replace HandleExcelFile with the name of the function used in final FloorsetEditor file to allocate data

        To fix: File persists when cancel button is pressed.
        -->
        <Button Class="Button" Id="buttonConfirmImport" Variant="primary" OnClickFunction="HandleExcelFile"
            IsDisabled=false TextAlignment="center">
            Import
        </Button>
    </FooterContent>
</Modal>

<script>
    function OpenImportModal() {
        /* Danielle Smith - 3/16/2025
        grabs the import excel modal and opens it */
        bootstrap.Modal.getOrCreateInstance('#importExcelModal').show();
    }
</script>

@code {
    private IBrowserFile? selectedFile;

    /*
    Set selectedFile to file placed in FileInput Tool
    */
    private void HandleFileSelected(IBrowserFile file)
    {
        selectedFile = file;
    }

    // Replace below with processing from the FloorSet Grid FE task
    // Processes it
    private void ProcessExcelFile(IBrowserFile file)
    {
        // Processing of excel file
    }

    // Runs when import button is pressed inside modal
    private void HandleExcelFile()
    {
        if (selectedFile == null) return;

        ProcessExcelFile(selectedFile);
    }

    /* Danielle Smith - 3/16/2025
    function that calls a javascript function to open the import file modal */
    private async Task OpenImportModal()
    {
        await JS.InvokeVoidAsync("OpenImportModal");
    }
}