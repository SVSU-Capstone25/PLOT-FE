@* Michael Polhill - 4/2/2025 *@

@page "/password-reset-request"
@layout Plot.Components.Layout.NotAuthenticatedLayout
@using Plot.Data.Models.Auth.ResetPassword
@using Microsoft.AspNetCore.Authorization
@attribute [AllowAnonymous]
@inject NavigationManager Navigation
@inject AuthHttpClient AuthHttpClient

<PageTitle>Password Reset Request</PageTitle>

<body class="background">
    <div class="passwordResetRequest">
        <EditForm Model="PasswordResetRequestModel" class="body-content">
            <img src="img/PlatoLogo.png" alt="Plato's closet logo" class="mx-auto d-block mb-2">
            <h4 class="text-center">Forgot your password?</h4>
            <p class="text-center">Enter your email to receive a password reset link</p>
            <label class="w-100 d-flex mt-2">
                <span class="mt-2 fw-bold">Email</span>
                <InputText id="email" type="text" @bind-Value="PasswordResetRequestModel!.EMAIL"
                    Class="w-85 form-control ms-auto" />
            </label>
            <div class="button-container mx-auto">
                <Button Class="Button" Id="buttonEmail" Variant="primary" OnClickFunction="SendResetEmail"
                    IsDisabled=false TextAlignment="center">
                    Send Reset Email
                </Button>
                <Button Class="Button" Id="buttonNavigateLogin" Variant="primary" OnClickFunction="NavigateToLogin"
                    IsDisabled=false TextAlignment="center">
                    Return To Login
                </Button>
            </div>
        </EditForm>
    </div>
</body>

@code
{
    [SupplyParameterFromForm]
    private Data.Models.Auth.ResetPassword.ResetPasswordRequest? PasswordResetRequestModel { get; set; }

    protected override void OnInitialized()
    {
        PasswordResetRequestModel ??= new();
    }

    private async void SendResetEmail()
    {
        if (PasswordResetRequestModel != null)
        {
            Console.WriteLine(PasswordResetRequestModel);

            var httpResponseCode = await AuthHttpClient.ResetPasswordRequest(PasswordResetRequestModel);

            NavigateToLogin();
        }
    }

    private void NavigateToLogin()
    {
        Navigation.NavigateTo("/login", forceLoad: true);
    }
}