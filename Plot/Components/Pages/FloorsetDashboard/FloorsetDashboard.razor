@* Filename: Floorsets.razor
Part of Project: PLOT

File Purpose:
This is the floorsets page component to showe the floorsets for a specific store 

Program Purpose:
The purpose of PLOT is to allow users to easily create, manage, 
and allocate floorsets for Platos Closet. 

Author: Andrew Fulton (3/13/2025)  *@

@* /floorsets/Flint, MI/3192 S Linden Rd, Flint, MI 48507 *@

@page "/floorsets/{storeId}/{storeLocation}"
@inject IJSRuntime JS
@inject NavigationManager Navigation

@* Top portion of the page (Showing store, location, and image for the current floorset) *@
<div class="container">
    <div class="left">
        <h1 font-size="3em">Floorsets for @storeId Store</h1>
        <br>
        <h3>@storeLocation</h3>
    </div>
    <div class="right">
        <img height="auto" width="500px" src="/img/FloorsetPhotoExample.png">
    </div>
</div>

@* Div to hold the floorset cards *@
<div id="floorsetCards" class="horizontal-items">

    @* Tristan Calay - 3/22/25
    Dynamically geenrate cards from stored floorsets.
    Iterate over each name and image in the floorsets.
    *@

    @foreach (var floorset in storedFloorsets)
    {
        <Card Id=@floorset.ID Class="Card" CardText=@floorset.Name CardImage=@floorset.ImagePath>
            <Dropdown Class="Dropdown" Id="@floorset.dropdownID" DropdownText="@(new List<string> { "Edit", "Copy", "Delete" })"
                DropdownLinks="@(new List<string> { "http://localhost:8080/floorset-editor", "javascript:onCopyFloorset()", "#deleteFloorsetModal" })"
                LabelText="Floorset"
                DropdownIcons="@(new List<string> { "fa-solid fa-pen-to-square", "fa-solid fa-copy", "fa-solid fa-trash-can" })" />
        </Card>
    }
</div>

@* + Add Floorset button fixed to the bottom right of the screen *@
<button class="fixed-bottom-right">
    <Button Class="Button" TextAlignment="center" Variant="primary" OnClickFunction="goToFloorsetEditorPage"
        Icon="fa-solid fa-plus">
        Add Floorset
    </Button>
</button>

@* HARD CODED MODAL: Delete Floorset modal *@
<Modal Title="Confirm Deletion" Id="deleteFloorsetModal" Class="standard">

    <BodyContent>
        <h5>Are you SURE you want to delete this Floorset?</h5>
        <TextInput type="text" Id="deleteModalTextInput" Label="If so, type DELETE below" />
    </BodyContent>

    <FooterContent>
        <p style="margin-left: auto;"></p>
        <Button Class="Button" TextAlignment="center" Variant="primary" OnClickFunction="deleteFloorset">
            Yes, Delete
        </Button>
    </FooterContent>
</Modal>

<script>
    // show the whichever modal ID is passed into it
    function showModal(modalId) {
        var modal = new bootstrap.Modal(document.getElementById(modalId));
        modal.show();
    }

    function HideModal(modalId) {
        /* Danielle Smith - 3/17/2025
        hide modal function that works with button component and id of modal passed in
        call remove modal backdrop twice because opening the delete modal makes two of them for some reason
        we will need to fix this in the future */
        document.getElementById(`${modalId}`).classList.remove('show');
        document.querySelector('.modal-backdrop')?.remove();
        document.querySelector('.modal-backdrop')?.remove();
    }

    function DeleteFloorset() {
        /* Danielle Smith - 3/18/2025
        function that mimics deleting a floorset. still checks if the text equals delete.
        if so, close the modal to mimic deleting a floorset. clear the text box for next use
        otherwise, alert the user */
        let deleteStr = document.getElementById("deleteModalTextInput").value;
        if (deleteStr.equals("DELETE")) {
            document.getElementById("deleteModalTextInput").value = "Delete";
            HideModal("deleteFloorsetModal");
        }
        else {
            alert("Incorrect input.");
        }
    }

    function onCopyFloorset(){
        DotNet.invokeAsyncMethod('PLOT','CopyFloorsetData');
    }

</script>

@code {
    [Parameter]
    public string? storeId { get; set; }

    [Parameter]
    public string? storeLocation { get; set; }

    //Tristan Calay - 3/22/25
    //Structure to store retreived database information on floorsets for rendering and local updates without page reload.
    //Stores the database ID, the display name, and the thumbnail image path.
    private struct storedFloorset
    {
        public storedFloorset(string id, string name, string img = "/img/FloorsetPhotoExample.png")
        {
            ID = id;
            Name = name;
            ImagePath = img;
        }

        public string dropdownID {
            get{
                return "Dropdown" + Name;
            }
        }

        public string ID {get;}

        public string Name {get; set;}

        public string ImagePath{get; set;}
    }   

    //Array of stored floorsets to display. Should be manipulated by copy and delete functions to have local updates.
    private storedFloorset[] storedFloorsets {get; set;} = [];

    //function for deleting a store
    private async void deleteFloorset()
    {
        Console.WriteLine("DELETE THIS FLOORSET");
        await JS.InvokeVoidAsync("DeleteFloorset");
    }

    //general function to take us to the floorsets editor page for a floorset store
    private void goToFloorsetEditorPage()
    {
        Navigation.NavigateTo("/floorset-editor", forceLoad: true);
    }


    //Tristan Calay - 3/22/25
    //Func to add a new floorset when the copy button is pressed.
    [JSInvokable]
    public static void CopyFloorsetData()
    {
        Console.WriteLine("Copy Floorset Func");
        //storedFloorsets.Append(new storedFloorset("Copy","Copy Test"));
    }

    //Retrieve the floorsets on initialization.
    protected override void OnInitialized()
    {
        storedFloorsets = getFloorsets();
        base.OnInitialized();
    }

    private storedFloorset[] getFloorsets(){
        storedFloorset[] floorsets = [
            new storedFloorset("0","Nov24Floorset"),
            new storedFloorset("1","Dec24Floorset"),
            new storedFloorset("2","Jan25Floorset"),
            new storedFloorset("3","Feb25Floorset"),
            new storedFloorset("4","Mar25Floorset"),
            new storedFloorset("5","Apr25Floorset"),
            new storedFloorset("6","May25Floorset"),
            new storedFloorset("8","Jun25Floorset"),
            new storedFloorset("9","Jul25Floorset"),
            new storedFloorset("10","Aug25Floorset"),
            new storedFloorset("11","Sep25Floorset"),
            new storedFloorset("12","Oct25Floorset")
        ];

        return floorsets;
    }
}